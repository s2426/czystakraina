<?php

require_once 'internals/forum_includes/site_header.html';

try
{
	$messages = array();
	foreach($browser = new Viny_ForumBrowser($forum_path . Viny_Forum::page_to_disk(@$_GET['thread']), Viny_Forum::MESSAGES, false) as $message)
	{
		$messages[] = $message;
	}

	$messages_size = sizeof($messages);
	usort($messages, array(
		$browser,
		'sort_messages',
	));
}
catch(Exception $error)
{
	echo '<p>Wystąpił błąd: przepraszamy!';
}

?>
<h3><?=htmlspecialchars(@$_GET['thread'])?></h3>
<?if($messages):?>
<table class='forum'>
<tbody>
<?foreach($messages as $counter => $message):?>
<tr>
	<th class='poster_data'>
	<?if(access(2)):?>
	<form action='<?=$self?>?thread=<?=@htmlspecialchars($_GET['thread'])?>' method='post'>
	<?endif?>
	<ul>
		<li>Wiadomość № <?=$messages_size - $counter?>
		<li>Autor: <?=$message -> get_author()?>
		<li><?=Viny_Forum::date($message -> getctime())?>
		<?if(access(2)):?>
		<li><input name='delete' type='submit' value='Usuń wiadomość' style='width: auto'>
		<?endif?>
	</ul>
	<?if(access(2)):?>
	<input type='hidden' name='message' value='<?=@htmlspecialchars(basename($message -> getfilename()))?>'>
	</form>
	<?endif?>
	<td><?=$message -> get_text()?>
<?endforeach?>
</table>
<?else:?>
<p>Brak wiadomości!
<?endif?>
<?require_once 'internals/forum_includes/site_footer.html'?>